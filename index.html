<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‚ú® 100 Gesture Particle Universe ‚ú®</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { overflow: hidden; background: #000; font-family: 'Segoe UI', sans-serif; }
canvas#particleCanvas { position: fixed; top: 0; left: 0; z-index: 1; }
video { position: fixed; bottom: 20px; right: 20px; width: 220px; height: 165px; border-radius: 16px; border: 2px solid rgba(255,255,255,0.2); z-index: 10; transform: scaleX(-1); object-fit: cover; }
#hud { position: fixed; top: 20px; left: 20px; z-index: 10; color: #fff; pointer-events: none; }
#hud h1 { font-size: 22px; background: linear-gradient(135deg, #ff6ec4, #7873f5, #4adede); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 6px; }
#gestureLabel { font-size: 42px; font-weight: 900; background: linear-gradient(135deg, #ff6ec4, #7873f5, #4adede); -webkit-background-clip: text; -webkit-text-fill-color: transparent; transition: all 0.3s; }
#gestureCount { font-size: 14px; color: rgba(255,255,255,0.5); margin-top: 4px; }
#instructions { position: fixed; bottom: 20px; left: 20px; z-index: 10; color: rgba(255,255,255,0.6); font-size: 13px; line-height: 1.6; background: rgba(0,0,0,0.5); padding: 12px 18px; border-radius: 12px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); max-width: 320px; }
#handStatus { position: fixed; top: 20px; right: 20px; z-index: 10; padding: 8px 16px; border-radius: 20px; font-size: 13px; backdrop-filter: blur(10px); }
.connected { background: rgba(0,255,136,0.2); color: #0f8; border: 1px solid rgba(0,255,136,0.3); }
.disconnected { background: rgba(255,68,68,0.2); color: #f66; border: 1px solid rgba(255,68,68,0.3); }
#progressBar { position: fixed; top: 70px; left: 20px; z-index: 10; width: 200px; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden; }
#progressFill { height: 100%; width: 0%; background: linear-gradient(90deg, #ff6ec4, #7873f5, #4adede); border-radius: 2px; transition: width 0.3s; }
#miniMap { position: fixed; top: 90px; left: 20px; z-index: 10; display: flex; flex-wrap: wrap; width: 200px; gap: 2px; pointer-events: auto; }
.miniDot { width: 8px; height: 8px; border-radius: 50%; background: rgba(255,255,255,0.15); transition: all 0.3s; cursor: pointer; }
.miniDot.active { background: #7873f5; box-shadow: 0 0 6px #7873f5; }
.miniDot.visited { background: rgba(120,115,245,0.4); }
</style>
</head>
<body>
<canvas id="particleCanvas"></canvas>
<video id="video" autoplay playsinline></video>

<div id="hud">
  <h1>‚ú® PARTICLE UNIVERSE</h1>
  <div id="gestureLabel">Initializing...</div>
  <div id="gestureCount">Gesture 0 / 100</div>
</div>

<div id="progressBar"><div id="progressFill"></div></div>
<div id="miniMap"></div>

<div id="handStatus" class="disconnected">üì∑ Starting Camera...</div>

<div id="instructions">
  <strong>üéÆ Controls:</strong><br>
  ‚úã Move hand in camera to interact<br>
  üëã Wave right/left = next/prev<br>
  ‚å®Ô∏è ‚Üê ‚Üí arrows to browse<br>
  ‚å®Ô∏è ‚Üë ‚Üì jump by 10<br>
  ‚å®Ô∏è Space = auto-cycle all 100<br>
  üñ±Ô∏è Mouse moves particles<br>
  üì± Swipe on mobile
</div>

<script>
const canvas = document.getElementById('particleCanvas');
const ctx = canvas.getContext('2d');
let W, H;
function resize() { W = canvas.width = window.innerWidth; H = canvas.height = window.innerHeight; }
resize();
window.addEventListener('resize', resize);

const PARTICLE_COUNT = 2000;
const particles = [];
let currentFormation = 0;
let handX = 0.5, handY = 0.5;
let handDetected = false;
let fingerCount = 0;
let autoCycle = false;
let autoCycleTimer = null;
let visitedFormations = new Set();
let globalTime = 0;
let colorScheme = { h1: 0, h2: 60, s: 100, l: 60 };
let bgStars = [];

for (let i = 0; i < 300; i++) {
  bgStars.push({ x: Math.random() * 2000, y: Math.random() * 2000, s: Math.random() * 2, b: Math.random() });
}

const miniMap = document.getElementById('miniMap');
for (let i = 0; i < 100; i++) {
  const dot = document.createElement('div');
  dot.className = 'miniDot';
  dot.title = 'Formation ' + (i + 1);
  dot.addEventListener('click', (function(idx) { return function() { setFormation(idx); }; })(i));
  miniMap.appendChild(dot);
}

class Particle {
  constructor(i) {
    this.x = Math.random() * W;
    this.y = Math.random() * H;
    this.tx = this.x;
    this.ty = this.y;
    this.vx = 0;
    this.vy = 0;
    this.size = 1.5 + Math.random() * 2;
    this.baseSize = this.size;
    this.hue = Math.random() * 360;
    this.alpha = 0.8;
    this.index = i;
    this.speed = 0.02 + Math.random() * 0.03;
    this.life = Math.random() * Math.PI * 2;
  }
  update() {
    this.life += 0.02;
    let dx = this.tx - this.x;
    let dy = this.ty - this.y;
    this.vx += dx * this.speed;
    this.vy += dy * this.speed;
    this.vx *= 0.88;
    this.vy *= 0.88;
    if (handDetected) {
      let hx = handX * W, hy = handY * H;
      let hdx = this.x - hx, hdy = this.y - hy;
      let hd = Math.sqrt(hdx * hdx + hdy * hdy);
      if (hd < 200) {
        let force = (200 - hd) / 200;
        if (fingerCount <= 1) {
          this.vx += hdx * force * 0.15;
          this.vy += hdy * force * 0.15;
        } else if (fingerCount === 2) {
          this.vx += (-hdy * force * 0.08);
          this.vy += (hdx * force * 0.08);
        } else {
          this.vx -= hdx * force * 0.05;
          this.vy -= hdy * force * 0.05;
        }
      }
    }
    this.x += this.vx;
    this.y += this.vy;
    this.size = this.baseSize + Math.sin(this.life) * 0.5;
  }
  draw() {
    let h = (this.hue + globalTime * 10) % 360;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
    ctx.fillStyle = 'hsla(' + h + ',' + colorScheme.s + '%,' + colorScheme.l + '%,' + this.alpha + ')';
    ctx.fill();
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.size * 3, 0, Math.PI * 2);
    ctx.fillStyle = 'hsla(' + h + ',' + colorScheme.s + '%,' + colorScheme.l + '%,' + (this.alpha * 0.1) + ')';
    ctx.fill();
  }
}

for (let i = 0; i < PARTICLE_COUNT; i++) particles.push(new Particle(i));

// TEXT RENDERER
let textCanvas, textCtx;
function initTextCanvas() {
  textCanvas = document.createElement('canvas');
  textCanvas.width = W;
  textCanvas.height = H;
  textCtx = textCanvas.getContext('2d');
}
initTextCanvas();

function getTextPosition(text, i, n) {
  textCtx.clearRect(0, 0, W, H);
  let fontSize = Math.min(W / text.length * 1.5, H * 0.4);
  textCtx.font = '900 ' + fontSize + 'px Arial, sans-serif';
  textCtx.textAlign = 'center';
  textCtx.textBaseline = 'middle';
  textCtx.fillStyle = '#fff';
  textCtx.fillText(text, W / 2, H / 2);
  let imageData = textCtx.getImageData(0, 0, W, H);
  let points = [];
  let step = Math.max(2, Math.floor(Math.sqrt(W * H / n)));
  for (let y = 0; y < H; y += step) {
    for (let x = 0; x < W; x += step) {
      if (imageData.data[(y * W + x) * 4 + 3] > 128) {
        points.push({ x: x, y: y });
      }
    }
  }
  if (points.length === 0) return { x: W / 2, y: H / 2 };
  return points[i % points.length];
}

// ========== ALL 100 UNIQUE FORMATIONS ==========
var formations = [
  // 1. Earth
  { name: "üåç Earth", color: { h1: 200, h2: 140, s: 80, l: 55 }, fn: function(i, n) { var a = Math.random()*Math.PI*2, r = Math.random()*Math.min(W,H)*0.25; return {x:W/2+Math.cos(a)*r, y:H/2+Math.sin(a)*r}; }},
  // 2. Saturn
  { name: "ü™ê Saturn", color: { h1: 35, h2: 50, s: 70, l: 60 }, fn: function(i, n) { if(i<n*0.6){var a=Math.random()*Math.PI*2,r=Math.random()*Math.min(W,H)*0.15;return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}else{var a=Math.random()*Math.PI*2,r=Math.min(W,H)*0.22+(Math.random()-0.5)*30;return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r*0.3};}}},
  // 3. Sun Corona
  { name: "‚òÄÔ∏è Sun Corona", color: { h1: 40, h2: 10, s: 100, l: 60 }, fn: function(i, n) { var a=(i/n)*Math.PI*2, r=Math.min(W,H)*0.15+Math.sin(a*12)*30+Math.random()*50; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},
  // 4. Crescent Moon
  { name: "üåô Crescent Moon", color: { h1: 45, h2: 55, s: 30, l: 80 }, fn: function(i, n) { var a=Math.random()*Math.PI*2,r=Math.random()*Math.min(W,H)*0.2; var x=W/2+Math.cos(a)*r,y=H/2+Math.sin(a)*r; var dx=x-(W/2+80),dy=y-H/2; if(Math.sqrt(dx*dx+dy*dy)<Math.min(W,H)*0.17) return{x:W/2+Math.cos(Math.random()*Math.PI*2)*Math.min(W,H)*0.22,y:H/2+Math.sin(Math.random()*Math.PI*2)*Math.min(W,H)*0.22}; return{x:x,y:y};}},
  // 5. Supernova Burst
  { name: "‚≠ê Supernova", color: { h1: 0, h2: 60, s: 100, l: 70 }, fn: function(i, n) { var a=(i/n)*Math.PI*2*3,r=(i/n)*Math.min(W,H)*0.35; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},
  // 6. Galaxy Spiral
  { name: "üåå Galaxy Spiral", color: { h1: 260, h2: 320, s: 80, l: 65 }, fn: function(i, n) { var a=(i/n)*Math.PI*6,r=(i/n)*Math.min(W,H)*0.35; return{x:W/2+Math.cos(a)*r+(Math.random()-0.5)*20,y:H/2+Math.sin(a)*r+(Math.random()-0.5)*20};}},
  // 7. Comet
  { name: "‚òÑÔ∏è Comet", color: { h1: 180, h2: 220, s: 90, l: 70 }, fn: function(i, n) { if(i<n*0.2){var a=Math.random()*Math.PI*2,r=Math.random()*50;return{x:W*0.3+Math.cos(a)*r,y:H*0.4+Math.sin(a)*r};}else{var t=Math.random()*3;return{x:W*0.3+t*W*0.15+(Math.random()-0.5)*t*60,y:H*0.4+t*H*0.05+(Math.random()-0.5)*t*40};}}},
  // 8. Constellation
  { name: "üî≠ Constellation", color: { h1: 200, h2: 240, s: 60, l: 80 }, fn: function(i, n) { var stars=[]; for(var j=0;j<20;j++) stars.push({x:W/2+(Math.random()-0.5)*W*0.6,y:H/2+(Math.random()-0.5)*H*0.6}); var s=stars[i%stars.length]; return{x:s.x+(Math.random()-0.5)*15,y:s.y+(Math.random()-0.5)*15};}},
  // 9. Eclipse
  { name: "üåë Eclipse", color: { h1: 30, h2: 0, s: 100, l: 50 }, fn: function(i, n) { var a=(i/n)*Math.PI*2,r=Math.min(W,H)*0.2; return{x:W/2+Math.cos(a)*r+(Math.random()-0.5)*10,y:H/2+Math.sin(a)*r+(Math.random()-0.5)*10};}},
  // 10. Binary Stars
  { name: "ü™ê Binary Stars", color: { h1: 200, h2: 30, s: 90, l: 65 }, fn: function(i, n) { var center=i<n/2?{x:W*0.35,y:H/2}:{x:W*0.65,y:H/2}; var a=Math.random()*Math.PI*2,r=Math.random()*Math.min(W,H)*0.12; return{x:center.x+Math.cos(a)*r,y:center.y+Math.sin(a)*r};}},

  // 11-20: WORDS
  { name: "üíñ LOVE", color: { h1: 340, h2: 0, s: 100, l: 65 }, fn: function(i, n) { return getTextPosition("LOVE", i, n); }},
  { name: "üåü DREAM", color: { h1: 45, h2: 280, s: 90, l: 70 }, fn: function(i, n) { return getTextPosition("DREAM", i, n); }},
  { name: "üî• FIRE", color: { h1: 10, h2: 50, s: 100, l: 55 }, fn: function(i, n) { return getTextPosition("FIRE", i, n); }},
  { name: "üåä OCEAN", color: { h1: 190, h2: 220, s: 85, l: 55 }, fn: function(i, n) { return getTextPosition("OCEAN", i, n); }},
  { name: "‚ú® STAR", color: { h1: 50, h2: 40, s: 100, l: 75 }, fn: function(i, n) { return getTextPosition("STAR", i, n); }},
  { name: "üéµ MUSIC", color: { h1: 280, h2: 320, s: 80, l: 65 }, fn: function(i, n) { return getTextPosition("MUSIC", i, n); }},
  { name: "üåà PEACE", color: { h1: 120, h2: 60, s: 70, l: 60 }, fn: function(i, n) { return getTextPosition("PEACE", i, n); }},
  { name: "üí´ MAGIC", color: { h1: 270, h2: 310, s: 90, l: 70 }, fn: function(i, n) { return getTextPosition("MAGIC", i, n); }},
  { name: "üéØ FOCUS", color: { h1: 0, h2: 30, s: 90, l: 60 }, fn: function(i, n) { return getTextPosition("FOCUS", i, n); }},
  { name: "üöÄ SPACE", color: { h1: 220, h2: 260, s: 80, l: 65 }, fn: function(i, n) { return getTextPosition("SPACE", i, n); }},

  // 21-30: GEOMETRY
  { name: "üî∫ Triangle", color: { h1: 120, h2: 180, s: 80, l: 55 }, fn: function(i, n) { var v=[[W/2,H*0.2],[W*0.2,H*0.8],[W*0.8,H*0.8]]; var e=i%3,ne=(e+1)%3,t=(i/n)*3%1; return{x:v[e][0]+(v[ne][0]-v[e][0])*t+(Math.random()-0.5)*10,y:v[e][1]+(v[ne][1]-v[e][1])*t+(Math.random()-0.5)*10};}},
  { name: "‚¨° Hexagon", color: { h1: 300, h2: 340, s: 75, l: 60 }, fn: function(i, n) { var s=6,e=i%s,a1=(e/s)*Math.PI*2-Math.PI/2,a2=((e+1)/s)*Math.PI*2-Math.PI/2,r=Math.min(W,H)*0.3,t=(i/n)*s%1; return{x:W/2+Math.cos(a1)*r+(Math.cos(a2)*r-Math.cos(a1)*r)*t,y:H/2+Math.sin(a1)*r+(Math.sin(a2)*r-Math.sin(a1)*r)*t};}},
  { name: "‚¨ü Pentagon", color: { h1: 160, h2: 200, s: 85, l: 55 }, fn: function(i, n) { var s=5,e=i%s,a1=(e/s)*Math.PI*2-Math.PI/2,a2=((e+1)/s)*Math.PI*2-Math.PI/2,r=Math.min(W,H)*0.3,t=(i/n)*s%1; return{x:W/2+Math.cos(a1)*r+(Math.cos(a2)*r-Math.cos(a1)*r)*t,y:H/2+Math.sin(a1)*r+(Math.sin(a2)*r-Math.sin(a1)*r)*t};}},
  { name: "üíé Diamond", color: { h1: 180, h2: 220, s: 90, l: 75 }, fn: function(i, n) { var v=[[W/2,H*0.15],[W*0.75,H/2],[W/2,H*0.85],[W*0.25,H/2]]; var e=i%4,ne=(e+1)%4,t=(i/n)*4%1; return{x:v[e][0]+(v[ne][0]-v[e][0])*t,y:v[e][1]+(v[ne][1]-v[e][1])*t};}},
  { name: "‚≠ï Circle Ring", color: { h1: 0, h2: 360, s: 90, l: 65 }, fn: function(i, n) { var a=(i/n)*Math.PI*2,r=Math.min(W,H)*0.3; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},
  { name: "‚ôæÔ∏è Infinity", color: { h1: 270, h2: 310, s: 85, l: 65 }, fn: function(i, n) { var t=(i/n)*Math.PI*2,s=Math.min(W,H)*0.25; return{x:W/2+s*Math.cos(t)/(1+Math.sin(t)*Math.sin(t)),y:H/2+s*Math.sin(t)*Math.cos(t)/(1+Math.sin(t)*Math.sin(t))};}},
  { name: "üåÄ Fibonacci", color: { h1: 45, h2: 140, s: 80, l: 55 }, fn: function(i, n) { var a=i*2.39996323,r=Math.sqrt(i/n)*Math.min(W,H)*0.35; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},
  { name: "üìê Octagon", color: { h1: 80, h2: 120, s: 70, l: 55 }, fn: function(i, n) { var s=8,e=i%s,a1=(e/s)*Math.PI*2,a2=((e+1)/s)*Math.PI*2,r=Math.min(W,H)*0.3,t=(i/n)*s%1; return{x:W/2+Math.cos(a1)*r+(Math.cos(a2)*r-Math.cos(a1)*r)*t,y:H/2+Math.sin(a1)*r+(Math.sin(a2)*r-Math.sin(a1)*r)*t};}},
  { name: "‚ú° Star of David", color: { h1: 40, h2: 60, s: 90, l: 70 }, fn: function(i, n) { var r=Math.min(W,H)*0.28; if(i<n/2){var a=(i/(n/2))*Math.PI*2;var e=Math.floor(a/(Math.PI*2/3));var a1=(e/3)*Math.PI*2-Math.PI/2;var a2=((e+1)/3)*Math.PI*2-Math.PI/2;var t=(a/(Math.PI*2/3))%1;return{x:W/2+Math.cos(a1)*r+(Math.cos(a2)*r-Math.cos(a1)*r)*t,y:H/2+Math.sin(a1)*r+(Math.sin(a2)*r-Math.sin(a1)*r)*t};}else{var j=i-n/2;var a=(j/(n/2))*Math.PI*2;var e=Math.floor(a/(Math.PI*2/3));var a1=(e/3)*Math.PI*2+Math.PI/6;var a2=((e+1)/3)*Math.PI*2+Math.PI/6;var t=(a/(Math.PI*2/3))%1;return{x:W/2+Math.cos(a1)*r+(Math.cos(a2)*r-Math.cos(a1)*r)*t,y:H/2+Math.sin(a1)*r+(Math.sin(a2)*r-Math.sin(a1)*r)*t};}}},
  { name: "üî∑ 3D Cube", color: { h1: 210, h2: 250, s: 80, l: 60 }, fn: function(i, n) { var edges=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]]; var pairs=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]]; var p=pairs[i%12];var t=(i/n)*12%1;var s=Math.min(W,H)*0.3; var x=(edges[p[0]][0]+(edges[p[1]][0]-edges[p[0]][0])*t-0.5)*s; var y=(edges[p[0]][1]+(edges[p[1]][1]-edges[p[0]][1])*t-0.5)*s; var z=(edges[p[0]][2]+(edges[p[1]][2]-edges[p[0]][2])*t-0.5)*s; return{x:W/2+x*0.8-z*0.3,y:H/2+y*0.8-z*0.3};}},

  // 31-40: NATURE
  { name: "‚ù§Ô∏è Heart", color: { h1: 340, h2: 360, s: 100, l: 60 }, fn: function(i, n) { var t=(i/n)*Math.PI*2,s=Math.min(W,H)*0.012; var x=16*Math.pow(Math.sin(t),3); var y=-(13*Math.cos(t)-5*Math.cos(2*t)-2*Math.cos(3*t)-Math.cos(4*t)); return{x:W/2+x*s,y:H/2+y*s};}},
  { name: "üå∏ Flower", color: { h1: 330, h2: 60, s: 85, l: 65 }, fn: function(i, n) { var t=(i/n)*Math.PI*2,r=Math.min(W,H)*0.25*Math.abs(Math.cos(t*2.5)); return{x:W/2+Math.cos(t)*r+(Math.random()-0.5)*10,y:H/2+Math.sin(t)*r+(Math.random()-0.5)*10};}},
  { name: "üå≥ Tree", color: { h1: 100, h2: 140, s: 70, l: 45 }, fn: function(i, n) { if(i<n*0.15){return{x:W/2+(Math.random()-0.5)*30,y:H*0.5+Math.random()*H*0.3};}else{var a=Math.random()*Math.PI*2,r=Math.random()*Math.min(W,H)*0.25;return{x:W/2+Math.cos(a)*r,y:H*0.35+Math.sin(a)*r*0.7};}}},
  { name: "üçÇ Leaf", color: { h1: 90, h2: 130, s: 75, l: 50 }, fn: function(i, n) { var t=(i/n)*Math.PI*2,r=Math.min(W,H)*0.2*(1+Math.cos(t))*Math.abs(Math.sin(t)); return{x:W/2+Math.cos(t)*r,y:H/2+Math.sin(t)*r*0.6};}},
  { name: "ü¶ã Butterfly", color: { h1: 280, h2: 320, s: 90, l: 65 }, fn: function(i, n) { var t=(i/n)*Math.PI*2; var r=Math.min(W,H)*0.2*(Math.exp(Math.cos(t))-2*Math.cos(4*t)+Math.pow(Math.sin(t/12),5)); return{x:W/2+Math.cos(t)*r,y:H/2+Math.sin(t)*r};}},
  { name: "üêö Shell Spiral", color: { h1: 25, h2: 45, s: 65, l: 65 }, fn: function(i, n) { var a=(i/n)*Math.PI*8,r=Math.exp(a*0.1)*3; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},
  { name: "‚ùÑÔ∏è Snowflake", color: { h1: 190, h2: 220, s: 60, l: 85 }, fn: function(i, n) { var branch=i%6,a=(branch/6)*Math.PI*2,d=(i/n)*Math.min(W,H)*0.3; var side=(Math.floor(i/6)%2===0)?1:-1; var pa=a+side*Math.PI/6*Math.sin(d*0.02); return{x:W/2+Math.cos(pa)*d,y:H/2+Math.sin(pa)*d};}},
  { name: "üåä Ocean Wave", color: { h1: 190, h2: 230, s: 80, l: 55 }, fn: function(i, n) { var x=(i/n)*W,y=H/2+Math.sin(x*0.01+i*0.1)*100+Math.sin(x*0.02)*50; return{x:x,y:y};}},
  { name: "üå∫ Rose", color: { h1: 340, h2: 10, s: 90, l: 60 }, fn: function(i, n) { var t=(i/n)*Math.PI*2*4,r=Math.min(W,H)*0.25*Math.cos(2.5*t); if(r<0)r=-r; return{x:W/2+Math.cos(t)*r,y:H/2+Math.sin(t)*r};}},
  { name: "üï∏Ô∏è Spider Web", color: { h1: 0, h2: 0, s: 0, l: 80 }, fn: function(i, n) { var rings=8,ring=Math.floor((i/n)*rings); var a=(i%Math.floor(n/rings))/(n/rings)*Math.PI*2; var r=(ring+1)/rings*Math.min(W,H)*0.35; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},

  // 41-50: SYMBOLS
  { name: "‚òÆÔ∏è Peace Sign", color: { h1: 120, h2: 160, s: 70, l: 55 }, fn: function(i, n) { var r=Math.min(W,H)*0.28; if(i<n*0.4){var a=(i/(n*0.4))*Math.PI*2;return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}else if(i<n*0.55){var t=(i-n*0.4)/(n*0.15);return{x:W/2,y:H/2-r+t*r*2};}else if(i<n*0.75){var t=(i-n*0.55)/(n*0.2);return{x:W/2+Math.sin(Math.PI/4)*r*t,y:H/2+Math.cos(Math.PI/4)*r*t};}else{var t=(i-n*0.75)/(n*0.25);return{x:W/2-Math.sin(Math.PI/4)*r*t,y:H/2+Math.cos(Math.PI/4)*r*t};}}},
  { name: "‚òØÔ∏è Yin Yang", color: { h1: 0, h2: 0, s: 0, l: 70 }, fn: function(i, n) { var r=Math.min(W,H)*0.28; if(i<n*0.5){var a=(i/(n*0.5))*Math.PI*2;return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}else if(i<n*0.75){var a=(i-n*0.5)/(n*0.25)*Math.PI;return{x:W/2+Math.cos(a)*r*0.5,y:H/2+Math.sin(a)*r*0.5};}else{var a=(i-n*0.75)/(n*0.25)*Math.PI+Math.PI;return{x:W/2+Math.cos(a)*r*0.5,y:H/2+Math.sin(a)*r*0.5};}}},
  { name: "‚ö° Lightning Bolt", color: { h1: 45, h2: 60, s: 100, l: 70 }, fn: function(i, n) { var segs=[{x:W*0.45,y:H*0.1},{x:W*0.5,y:H*0.35},{x:W*0.42,y:H*0.4},{x:W*0.55,y:H*0.65},{x:W*0.47,y:H*0.7},{x:W*0.58,y:H*0.95}]; var ts=segs.length-1,seg=Math.floor((i/n)*ts),t=((i/n)*ts)%1; if(seg>=ts)seg=ts-1; return{x:segs[seg].x+(segs[seg+1].x-segs[seg].x)*t+(Math.random()-0.5)*20,y:segs[seg].y+(segs[seg+1].y-segs[seg].y)*t+(Math.random()-0.5)*10};}},
  { name: "üéµ Music Note", color: { h1: 280, h2: 320, s: 80, l: 60 }, fn: function(i, n) { if(i<n*0.3){var a=Math.random()*Math.PI*2,r=Math.random()*40;return{x:W*0.45+Math.cos(a)*r,y:H*0.7+Math.sin(a)*r};}else if(i<n*0.6){var t=(i-n*0.3)/(n*0.3);return{x:W*0.45+40+t*5,y:H*0.7-t*H*0.45};}else{var a=Math.random()*Math.PI*2,r=Math.random()*30;return{x:W*0.45+45+Math.cos(a)*r,y:H*0.25+Math.sin(a)*r};}}},
  { name: "üîë Key", color: { h1: 40, h2: 50, s: 85, l: 60 }, fn: function(i, n) { if(i<n*0.4){var a=(i/(n*0.4))*Math.PI*2,r=Math.min(W,H)*0.12;return{x:W*0.35+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}else{var t=(i-n*0.4)/(n*0.6);return{x:W*0.35+Math.min(W,H)*0.12+t*W*0.3,y:H/2+(Math.floor(t*4)%2===0&&t>0.6?-20:0)+(Math.random()-0.5)*5};}}},
  { name: "üëë Crown", color: { h1: 40, h2: 55, s: 100, l: 60 }, fn: function(i, n) { var t=i/n,x=W*0.2+t*W*0.6; var peaks=Math.sin(t*Math.PI*5)*H*0.1; var y=H*0.4+peaks; if(i>n*0.8){y=H*0.5;x=W*0.2+((i-n*0.8)/(n*0.2))*W*0.6;} return{x:x+(Math.random()-0.5)*8,y:y+(Math.random()-0.5)*8};}},
  { name: "üé≠ Theater", color: { h1: 0, h2: 60, s: 80, l: 60 }, fn: function(i, n) { var r=Math.min(W,H)*0.15; if(i<n/2){var a=Math.random()*Math.PI*2,rr=Math.random()*r;return{x:W*0.35+Math.cos(a)*rr,y:H/2+Math.sin(a)*rr};}else{var a=Math.random()*Math.PI*2,rr=Math.random()*r;return{x:W*0.65+Math.cos(a)*rr,y:H/2+Math.sin(a)*rr};}}},
  { name: "‚öì Anchor", color: { h1: 210, h2: 240, s: 70, l: 50 }, fn: function(i, n) { if(i<n*0.3){var a=(i/(n*0.3))*Math.PI,r=Math.min(W,H)*0.08;return{x:W/2+Math.cos(a)*r,y:H*0.25+Math.sin(a)*r};}else if(i<n*0.6){var t=(i-n*0.3)/(n*0.3);return{x:W/2,y:H*0.25+t*H*0.45};}else{var t=(i-n*0.6)/(n*0.4),a=t*Math.PI;return{x:W/2+Math.cos(a)*W*0.15,y:H*0.7-Math.sin(a)*H*0.1};}}},
  { name: "üéØ Bullseye", color: { h1: 0, h2: 30, s: 90, l: 55 }, fn: function(i, n) { var ring=Math.floor((i/n)*5),a=(i%(n/5))/(n/5)*Math.PI*2,r=(ring+1)*Math.min(W,H)*0.06; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},
  { name: "üîÆ Crystal Ball", color: { h1: 260, h2: 300, s: 80, l: 65 }, fn: function(i, n) { var a=Math.random()*Math.PI*2,r=Math.random()*Math.min(W,H)*0.25; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},

  // 51-60: SCIENCE
  { name: "üß¨ DNA Helix", color: { h1: 120, h2: 200, s: 80, l: 55 }, fn: function(i, n) { var t=(i/n)*H,a=t*0.03,r=Math.min(W,H)*0.15; var side=i%2===0?1:-1; return{x:W/2+Math.cos(a)*r*side,y:t};}},
  { name: "‚öõÔ∏è Atom", color: { h1: 200, h2: 240, s: 90, l: 65 }, fn: function(i, n) { if(i<n*0.1){var a=Math.random()*Math.PI*2,r=Math.random()*20;return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}else{var orbit=Math.floor((i-n*0.1)/(n*0.3));var a=((i-n*0.1)/(n*0.3))*Math.PI*2*3;var r=Math.min(W,H)*0.25;var tilt=orbit*Math.PI/3;return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r*Math.cos(tilt)};}}},
  { name: "üìä Sine Wave", color: { h1: 160, h2: 200, s: 80, l: 60 }, fn: function(i, n) { var x=(i/n)*W; return{x:x,y:H/2+Math.sin(x*0.02)*H*0.3};}},
  { name: "üìà Helix Tower", color: { h1: 300, h2: 340, s: 80, l: 60 }, fn: function(i, n) { var t=(i/n)*Math.PI*8,r=Math.min(W,H)*0.2; return{x:W/2+Math.cos(t)*r,y:H*0.1+((i/n)*H*0.8)};}},
  { name: "üî¨ Fractal Tree", color: { h1: 100, h2: 60, s: 70, l: 50 }, fn: function(i, n) { var depth=7,angle=Math.PI/4,idx=i; var x=W/2,y=H*0.85,a=-Math.PI/2,len=H*0.2; for(var d=0;d<depth;d++){var dir=(idx>>(depth-1-d))&1;a+=dir?angle:-angle;len*=0.65;x+=Math.cos(a)*len;y+=Math.sin(a)*len;} return{x:x+(Math.random()-0.5)*5,y:y+(Math.random()-0.5)*5};}},
  { name: "üåê Sphere Grid", color: { h1: 180, h2: 220, s: 70, l: 60 }, fn: function(i, n) { var phi=Math.acos(1-2*(i+0.5)/n); var theta=Math.PI*(1+Math.sqrt(5))*(i+0.5); var r=Math.min(W,H)*0.3; return{x:W/2+r*Math.sin(phi)*Math.cos(theta),y:H/2+r*Math.cos(phi)};}},
  { name: "üìê Lissajous", color: { h1: 30, h2: 60, s: 85, l: 60 }, fn: function(i, n) { var t=(i/n)*Math.PI*2,r=Math.min(W,H)*0.3; return{x:W/2+Math.sin(3*t)*r,y:H/2+Math.sin(2*t)*r};}},
  { name: "üßÆ Matrix Grid", color: { h1: 120, h2: 140, s: 100, l: 50 }, fn: function(i, n) { var cols=40,rows=Math.ceil(n/cols),c=i%cols,r=Math.floor(i/cols); return{x:(c/cols)*W*0.8+W*0.1,y:(r/rows)*H*0.8+H*0.1};}},
  { name: "üé≤ Random Walk", color: { h1: 0, h2: 360, s: 80, l: 65 }, fn: function(i, n) { var x=W/2,y=H/2,seed=i*13+7; for(var j=0;j<20;j++){seed=(seed*1103515245+12345)&0x7fffffff;x+=(seed%100-50)*2;seed=(seed*1103515245+12345)&0x7fffffff;y+=(seed%100-50)*2;} return{x:Math.max(50,Math.min(W-50,x)),y:Math.max(50,Math.min(H-50,y))};}},
  { name: "üî¢ Pi Spiral", color: { h1: 45, h2: 200, s: 75, l: 60 }, fn: function(i, n) { var a=i*3.14159*0.1,r=Math.sqrt(i)*Math.min(W,H)*0.02; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},

  // 61-70: CREATURES
  { name: "üêç Snake", color: { h1: 100, h2: 140, s: 75, l: 50 }, fn: function(i, n) { var t=(i/n)*W*0.8,x=W*0.1+t; return{x:x,y:H/2+Math.sin(t*0.02)*H*0.2};}},
  { name: "üêâ Dragon Breath", color: { h1: 10, h2: 50, s: 100, l: 55 }, fn: function(i, n) { var t=(i/n)*3,spread=t*80; return{x:W*0.2+t*W*0.25,y:H/2+(Math.random()-0.5)*spread};}},
  { name: "ü¶Ö Eagle Wings", color: { h1: 25, h2: 45, s: 60, l: 50 }, fn: function(i, n) { var t=(i/n)*2-1,wing=Math.abs(t); var y=H/2-Math.sqrt(wing)*H*0.3+Math.abs(t)*H*0.15; return{x:W/2+t*W*0.4,y:y+(Math.random()-0.5)*20};}},
  { name: "üêô Octopus", color: { h1: 280, h2: 320, s: 70, l: 55 }, fn: function(i, n) { if(i<n*0.3){var a=Math.random()*Math.PI*2,r=Math.random()*Math.min(W,H)*0.1;return{x:W/2+Math.cos(a)*r,y:H*0.35+Math.sin(a)*r};}else{var arm=Math.floor((i-n*0.3)/(n*0.7)*8); var t=((i-n*0.3)/(n*0.7)*8)%1; var a=(arm/8)*Math.PI*2+Math.PI/2; var r=t*Math.min(W,H)*0.3; return{x:W/2+Math.cos(a+Math.sin(t*3)*0.5)*r,y:H*0.35+Math.sin(a+Math.sin(t*3)*0.3)*r+t*50};}}},
  { name: "üïäÔ∏è Dove", color: { h1: 0, h2: 0, s: 0, l: 90 }, fn: function(i, n) { var t=(i/n)*Math.PI*2,r=Math.min(W,H)*0.15*(1+0.5*Math.cos(2*t)); return{x:W/2+Math.cos(t)*r*1.5,y:H/2+Math.sin(t)*r};}},
  { name: "üêã Whale", color: { h1: 210, h2: 240, s: 60, l: 50 }, fn: function(i, n) { var t=(i/n)*Math.PI*2,r=Math.min(W,H)*0.2*(1+0.3*Math.cos(t)); return{x:W/2+Math.cos(t)*r*1.8,y:H/2+Math.sin(t)*r};}},
  { name: "ü¶ä Fox", color: { h1: 20, h2: 40, s: 85, l: 55 }, fn: function(i, n) { if(i<n/2){var t=i/(n/2);return{x:W*0.35+t*60,y:H*0.3+t*H*0.2+(Math.random()-0.5)*15};}else{var t=(i-n/2)/(n/2);return{x:W*0.55+t*60,y:H*0.5-t*H*0.2+(Math.random()-0.5)*15};}}},
  { name: "ü¶ú Parrot Feathers", color: { h1: 0, h2: 120, s: 90, l: 60 }, fn: function(i, n) { var layer=Math.floor((i/n)*8); var a=((i%(n/8))/(n/8))*Math.PI-Math.PI/2; var r=Math.min(W,H)*0.1*(layer+1)*0.4; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r+(layer-4)*15};}},
  { name: "üêù Honeycomb", color: { h1: 40, h2: 55, s: 90, l: 55 }, fn: function(i, n) { var cols=15,c=i%cols,r=Math.floor(i/cols); var hexW=W/(cols+1),hexH=hexW*0.866; return{x:(c+1)*hexW+(r%2)*hexW*0.5,y:(r+1)*hexH*0.75};}},
  { name: "üï∑Ô∏è Web Radial", color: { h1: 0, h2: 0, s: 0, l: 75 }, fn: function(i, n) { var spokes=12,spoke=i%spokes; var a=(spoke/spokes)*Math.PI*2; var r=Math.floor(i/spokes)/Math.floor(n/spokes)*Math.min(W,H)*0.35; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},

  // 71-80: WEATHER
  { name: "üå™Ô∏è Tornado", color: { h1: 200, h2: 160, s: 40, l: 50 }, fn: function(i, n) { var t=i/n,a=t*Math.PI*12,r=(1-t)*Math.min(W,H)*0.3+10; return{x:W/2+Math.cos(a)*r,y:H*0.1+t*H*0.8};}},
  { name: "üåßÔ∏è Rain", color: { h1: 200, h2: 220, s: 70, l: 65 }, fn: function(i, n) { return{x:(i%50)/50*W,y:(Math.floor(i/50)/Math.floor(n/50))*H};}},
  { name: "üî• Flames", color: { h1: 0, h2: 50, s: 100, l: 55 }, fn: function(i, n) { var t=Math.random(),spread=(1-t)*W*0.15; return{x:W/2+(Math.random()-0.5)*spread,y:H*0.8-t*H*0.5};}},
  { name: "üí® Wind Lines", color: { h1: 190, h2: 210, s: 40, l: 75 }, fn: function(i, n) { var row=Math.floor(i/(n/8)),t=(i%(n/8))/(n/8); var y=H*0.15+row*H*0.1; return{x:t*W+Math.sin(t*10+row)*30,y:y+Math.sin(t*5)*20};}},
  { name: "‚õàÔ∏è Storm Cloud", color: { h1: 240, h2: 280, s: 60, l: 40 }, fn: function(i, n) { if(i<n*0.7){var a=Math.random()*Math.PI*2,r=Math.random()*Math.min(W,H)*0.35;return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}else{var t=(i-n*0.7)/(n*0.3);return{x:W/2+(Math.random()-0.5)*100,y:H*0.3+t*H*0.5};}}},
  { name: "üå§Ô∏è Sunrise", color: { h1: 30, h2: 60, s: 100, l: 65 }, fn: function(i, n) { if(i<n*0.4){var a=(i/(n*0.4))*Math.PI,r=Math.min(W,H)*0.2;return{x:W/2+Math.cos(a)*r,y:H*0.6-Math.sin(a)*r};}else{var t=(i-n*0.4)/(n*0.6),a=t*Math.PI; var r=Math.min(W,H)*0.2+((i-n*0.4)%4)*20; return{x:W/2+Math.cos(a)*r*1.5,y:H*0.6-Math.sin(a)*r*0.3};}}},
  { name: "üåà Rainbow", color: { h1: 0, h2: 300, s: 90, l: 60 }, fn: function(i, n) { var band=Math.floor((i/n)*7); var a=((i%(n/7))/(n/7))*Math.PI; var r=Math.min(W,H)*0.2+band*20; return{x:W/2+Math.cos(a)*r,y:H*0.6-Math.sin(a)*r};}},
  { name: "üíß Droplet", color: { h1: 200, h2: 230, s: 85, l: 60 }, fn: function(i, n) { var t=(i/n)*Math.PI*2,r=Math.min(W,H)*0.2*(1-0.4*Math.cos(t)); return{x:W/2+r*Math.sin(t)*0.6,y:H/2+r*Math.cos(t)};}},
  { name: "üå´Ô∏è Mist", color: { h1: 200, h2: 210, s: 20, l: 75 }, fn: function(i, n) { return{x:Math.random()*W,y:H*0.3+Math.random()*H*0.4+Math.sin(i*0.1)*20};}},
  { name: "‚ùÑÔ∏è Blizzard", color: { h1: 200, h2: 220, s: 50, l: 85 }, fn: function(i, n) { var x=Math.random()*W,y=Math.random()*H; return{x:x+Math.sin(y*0.01)*50,y:y};}},

  // 81-90: ABSTRACT
  { name: "üé® Paint Splash", color: { h1: 0, h2: 360, s: 90, l: 60 }, fn: function(i, n) { var a=Math.random()*Math.PI*2; var r=Math.pow(Math.random(),0.5)*Math.min(W,H)*0.4; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},
  { name: "üåä Fluid Sim", color: { h1: 180, h2: 300, s: 80, l: 60 }, fn: function(i, n) { var x=(i%50)/50*W,y=(Math.floor(i/50)/(n/50))*H; x+=Math.sin(y*0.01+i*0.001)*80; y+=Math.cos(x*0.01)*60; return{x:x,y:y};}},
  { name: "üí† Mandala", color: { h1: 270, h2: 330, s: 80, l: 65 }, fn: function(i, n) { var sym=8,a=(i/n)*Math.PI*2; var sa=Math.floor(a/(Math.PI*2/sym))*(Math.PI*2/sym); var la=a%(Math.PI*2/sym); var r=Math.min(W,H)*0.3*Math.sin(la*sym*0.5); return{x:W/2+Math.cos(sa+la)*r,y:H/2+Math.sin(sa+la)*r};}},
  { name: "üîÑ Vortex", color: { h1: 180, h2: 280, s: 85, l: 60 }, fn: function(i, n) { var a=(i/n)*Math.PI*20,r=(i/n)*Math.min(W,H)*0.4; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},
  { name: "ü´ß Bubbles", color: { h1: 180, h2: 300, s: 60, l: 75 }, fn: function(i, n) { var bubble=i%30,bx=(bubble*67+100)%W,by=(bubble*97+50)%H; var r=20+bubble%5*15,a=(i/n)*Math.PI*2*30; return{x:bx+Math.cos(a)*r,y:by+Math.sin(a)*r};}},
  { name: "üéÜ Fireworks", color: { h1: 0, h2: 60, s: 100, l: 65 }, fn: function(i, n) { var burst=Math.floor(i/(n/5)); var cx=W*0.2+burst*W*0.15,cy=H*0.2+Math.sin(burst)*H*0.2; var a=Math.random()*Math.PI*2,r=Math.random()*Math.min(W,H)*0.12; return{x:cx+Math.cos(a)*r,y:cy+Math.sin(a)*r};}},
  { name: "‚ú® Stardust Ring", color: { h1: 40, h2: 60, s: 100, l: 80 }, fn: function(i, n) { var a=(i/n)*Math.PI*2; var r=Math.min(W,H)*0.3+Math.sin(a*8)*30; return{x:W/2+Math.cos(a)*r+Math.random()*40-20,y:H/2+Math.sin(a)*r+Math.random()*40-20};}},
  { name: "üåÄ Black Hole", color: { h1: 260, h2: 300, s: 90, l: 50 }, fn: function(i, n) { var a=(i/n)*Math.PI*2*8; var r=Math.min(W,H)*0.35*(1-Math.pow(i/n,0.5)); return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r*0.6};}},
  { name: "üí• Explosion", color: { h1: 10, h2: 50, s: 100, l: 60 }, fn: function(i, n) { var a=Math.random()*Math.PI*2; var r=Math.pow(Math.random(),2)*Math.min(W,H)*0.4; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},
  { name: "üåä Ripple", color: { h1: 200, h2: 240, s: 75, l: 60 }, fn: function(i, n) { var ring=Math.floor((i/n)*10); var a=(i%(n/10))/(n/10)*Math.PI*2; var r=(ring+1)*Math.min(W,H)*0.03; return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}},

  // 91-100: EPIC FINALS
  { name: "üèîÔ∏è Mountains", color: { h1: 200, h2: 120, s: 40, l: 50 }, fn: function(i, n) { var x=(i/n)*W,y=H*0.6; var peaks=[W*0.2,W*0.4,W*0.6,W*0.8]; for(var p=0;p<peaks.length;p++){var d=Math.abs(x-peaks[p]);if(d<W*0.2)y=Math.min(y,H*0.6-Math.max(0,(W*0.2-d))*1.2);} return{x:x,y:y+(Math.random()-0.5)*15};}},
  { name: "üèôÔ∏è City Skyline", color: { h1: 220, h2: 260, s: 50, l: 50 }, fn: function(i, n) { var col=Math.floor((i/n)*30),row=i%Math.floor(n/30); var bh=((col*77+33)%100)/100*H*0.5+H*0.1; var x=(col/30)*W,y=H-row*(H/Math.floor(n/30)); if(y<H-bh)y=H-bh+Math.random()*10; return{x:x+Math.random()*15,y:y};}},
  { name: "üé™ Circus Tent", color: { h1: 0, h2: 50, s: 90, l: 55 }, fn: function(i, n) { var t=(i/n)*Math.PI*2; var r=Math.min(W,H)*0.35; var y=H*0.3+Math.abs(Math.cos(t*6))*H*0.25; return{x:W/2+Math.cos(t)*r*(1-((y-H*0.3)/(H*0.25))*0.3),y:y};}},
  { name: "üé° Ferris Wheel", color: { h1: 0, h2: 60, s: 80, l: 65 }, fn: function(i, n) { var r=Math.min(W,H)*0.3; if(i<n*0.7){var a=(i/(n*0.7))*Math.PI*2;return{x:W/2+Math.cos(a)*r,y:H/2+Math.sin(a)*r};}else{var spokes=12; var spoke=Math.floor((i-n*0.7)/(n*0.3)*spokes); var t=((i-n*0.7)/(n*0.3)*spokes)%1; var a=(spoke/spokes)*Math.PI*2; return{x:W/2+Math.cos(a)*r*t,y:H/2+Math.sin(a)*r*t};}}},
  { name: "üé∏ Guitar", color: { h1: 25, h2: 40, s: 70, l: 50 }, fn: function(i, n) { if(i<n*0.4){var a=Math.random()*Math.PI*2,r=Math.random()*Math.min(W,H)*0.12;return{x:W/2+Math.cos(a)*r*1.2,y:H*0.6+Math.sin(a)*r};}else if(i<n*0.7){var t=(i-n*0.4)/(n*0.3);return{x:W/2+(Math.random()-0.5)*30,y:H*0.6-t*H*0.35};}else{var a=Math.random()*Math.PI*2,r=Math.random()*50;return{x:W/2+Math.cos(a)*r,y:H*0.25+Math.sin(a)*r};}}},
  { name: "üöÄ Rocket Ship", color: { h1: 0, h2: 210, s: 85, l: 60 }, fn: function(i, n) { if(i<n*0.5){var t=(i/(n*0.5))*2-1;var w=30*(1-Math.abs(t)*0.5);return{x:W/2+(Math.random()-0.5)*w,y:H*0.2+((i/(n*0.5)))*H*0.35};}else{var t=(i-n*0.5)/(n*0.5);var spread=t*80;return{x:W/2+(Math.random()-0.5)*spread,y:H*0.55+t*H*0.3};}}},
  { name: "üéª Treble Clef", color: { h1: 40, h2: 60, s: 80, l: 55 }, fn: function(i, n) { var t=(i/n)*Math.PI*4,r=Math.min(W,H)*0.1+Math.sin(t)*30; return{x:W/2+Math.cos(t)*r,y:H*0.2+((i/n))*H*0.6};}},
  { name: "üå† Shooting Stars", color: { h1: 40, h2: 200, s: 90, l: 75 }, fn: function(i, n) { var star=Math.floor(i/(n/8)),t=(i%(n/8))/(n/8); var sx=W*0.1+star*W*0.1,sy=H*0.1+star*H*0.05; return{x:sx+t*W*0.3,y:sy+t*H*0.15+(Math.random()-0.5)*5};}},
  { name: "üéä Confetti", color: { h1: 0, h2: 360, s: 100, l: 65 }, fn: function(i, n) { return{x:Math.random()*W,y:Math.random()*H};}},
  { name: "üëÅÔ∏è Eye of Universe", color: { h1: 180, h2: 280, s: 90, l: 60 }, fn: function(i, n) { var t=(i/n)*Math.PI*2,r=Math.min(W,H)*0.25; if(i<n*0.5){return{x:W/2+Math.cos(t)*r,y:H/2+Math.sin(t)*r*0.4};}else if(i<n*0.7){var a=Math.random()*Math.PI*2,rr=Math.random()*Math.min(W,H)*0.08;return{x:W/2+Math.cos(a)*rr,y:H/2+Math.sin(a)*rr};}else{var a=Math.random()*Math.PI*2,rr=Math.random()*25;return{x:W/2+Math.cos(a)*rr,y:H/2+Math.sin(a)*rr};}}}
];

// SET FORMATION
function setFormation(index) {
  if (index < 0) index = 99;
  currentFormation = index % formations.length;
  var f = formations[currentFormation];
  colorScheme = f.color;
  visitedFormations.add(currentFormation);

  for (var i = 0; i < particles.length; i++) {
    var pos = f.fn(i, PARTICLE_COUNT);
    particles[i].tx = pos.x;
    particles[i].ty = pos.y;
    particles[i].hue = f.color.h1 + (f.color.h2 - f.color.h1) * (i / PARTICLE_COUNT);
  }

  document.getElementById('gestureLabel').textContent = f.name;
  document.getElementById('gestureCount').textContent = 'Gesture ' + (currentFormation + 1) + ' / 100';
  document.getElementById('progressFill').style.width = (((currentFormation + 1) / 100) * 100) + '%';

  var dots = document.querySelectorAll('.miniDot');
  for (var j = 0; j < dots.length; j++) {
    dots[j].className = 'miniDot' + (j === currentFormation ? ' active' : (visitedFormations.has(j) ? ' visited' : ''));
  }
}

// CAMERA & MOTION DETECTION
var video = document.getElementById('video');
var prevFrame = null;
var lastGestureTime = 0;

async function startCamera() {
  try {
    var stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user', width: 320, height: 240 } });
    video.srcObject = stream;
    document.getElementById('handStatus').className = 'connected';
    document.getElementById('handStatus').textContent = 'üì∑ Camera Active ‚Äî Move hand!';
    video.addEventListener('loadeddata', function() { detectMotion(); });
  } catch (e) {
    document.getElementById('handStatus').className = 'disconnected';
    document.getElementById('handStatus').textContent = '‚å®Ô∏è Use Arrow Keys / Space';
  }
}

function detectMotion() {
  var detectCanvas = document.createElement('canvas');
  detectCanvas.width = 80;
  detectCanvas.height = 60;
  var dctx = detectCanvas.getContext('2d', { willReadFrequently: true });

  function processFrame() {
    dctx.drawImage(video, 0, 0, 80, 60);
    var frame = dctx.getImageData(0, 0, 80, 60);

    if (prevFrame) {
      var totalMotion = 0, motionX = 0, motionY = 0, motionCount = 0;
      var regionMotion = { left: 0, right: 0, top: 0, bottom: 0 };

      for (var y = 0; y < 60; y++) {
        for (var x = 0; x < 80; x++) {
          var idx = (y * 80 + x) * 4;
          var diff = Math.abs(frame.data[idx] - prevFrame.data[idx]) +
                     Math.abs(frame.data[idx + 1] - prevFrame.data[idx + 1]) +
                     Math.abs(frame.data[idx + 2] - prevFrame.data[idx + 2]);
          if (diff > 60) {
            totalMotion += diff;
            motionX += x;
            motionY += y;
            motionCount++;
            if (x < 26) regionMotion.left += diff;
            else if (x > 53) regionMotion.right += diff;
            if (y < 20) regionMotion.top += diff;
            else if (y > 40) regionMotion.bottom += diff;
          }
        }
      }

      var motionLevel = totalMotion / (80 * 60 * 3);

      if (motionCount > 10) {
        handDetected = true;
        handX = 1 - (motionX / motionCount) / 80;
        handY = (motionY / motionCount) / 60;

        var spread = Math.sqrt(motionCount) / 8;
        if (spread > 3) fingerCount = 5;
        else if (spread > 2) fingerCount = 2;
        else if (spread > 1) fingerCount = 1;
        else fingerCount = 0;

        var now = Date.now();
        if (now - lastGestureTime > 800 && motionLevel > 15) {
          lastGestureTime = now;
          if (regionMotion.right > regionMotion.left * 1.5) {
            setFormation(currentFormation + 1);
          } else if (regionMotion.left > regionMotion.right * 1.5) {
            setFormation(currentFormation - 1);
          } else if (regionMotion.top > regionMotion.bottom * 1.5) {
            setFormation(currentFormation + 10);
          } else if (regionMotion.bottom > regionMotion.top * 1.5) {
            setFormation(currentFormation - 10);
          } else {
            setFormation(currentFormation + 1);
          }
        }
      } else {
        handDetected = false;
      }
    }

    prevFrame = new ImageData(new Uint8ClampedArray(frame.data), 80, 60);
    requestAnimationFrame(processFrame);
  }
  processFrame();
}

startCamera();

// KEYBOARD
document.addEventListener('keydown', function(e) {
  if (e.key === 'ArrowRight') setFormation(currentFormation + 1);
  else if (e.key === 'ArrowLeft') setFormation(currentFormation - 1);
  else if (e.key === 'ArrowUp') setFormation(currentFormation + 10);
  else if (e.key === 'ArrowDown') setFormation(currentFormation - 10);
  else if (e.key === ' ') {
    e.preventDefault();
    autoCycle = !autoCycle;
    if (autoCycle) {
      autoCycleTimer = setInterval(function() { setFormation(currentFormation + 1); }, 3000);
      document.getElementById('handStatus').textContent = 'üîÑ Auto-cycling...';
      document.getElementById('handStatus').className = 'connected';
    } else {
      clearInterval(autoCycleTimer);
      document.getElementById('handStatus').textContent = '‚è∏Ô∏è Paused';
    }
  }
});

// MOUSE
canvas.addEventListener('mousemove', function(e) {
  handX = e.clientX / W;
  handY = e.clientY / H;
});
canvas.addEventListener('mousedown', function() { fingerCount = 0; handDetected = true; });
canvas.addEventListener('mouseup', function() { fingerCount = 5; handDetected = false; });

// TOUCH
canvas.addEventListener('touchmove', function(e) {
  e.preventDefault();
  handX = e.touches[0].clientX / W;
  handY = e.touches[0].clientY / H;
  handDetected = true;
}, { passive: false });
canvas.addEventListener('touchend', function() { handDetected = false; });

var touchStartX = 0, touchStartY = 0;
document.addEventListener('touchstart', function(e) {
  touchStartX = e.touches[0].clientX;
  touchStartY = e.touches[0].clientY;
});
document.addEventListener('touchend', function(e) {
  var dx = e.changedTouches[0].clientX - touchStartX;
  var dy = e.changedTouches[0].clientY - touchStartY;
  if (Math.abs(dx) > 50 || Math.abs(dy) > 50) {
    if (Math.abs(dx) > Math.abs(dy)) {
      setFormation(dx > 0 ? currentFormation - 1 : currentFormation + 1);
    } else {
      setFormation(dy > 0 ? currentFormation - 10 : currentFormation + 10);
    }
  }
});

// RENDER
function drawBackground() {
  ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
  ctx.fillRect(0, 0, W, H);
  for (var s = 0; s < bgStars.length; s++) {
    var star = bgStars[s];
    var twinkle = 0.3 + 0.7 * Math.sin(globalTime * 2 + star.b * 10);
    ctx.beginPath();
    ctx.arc(star.x % W, star.y % H, star.s, 0, Math.PI * 2);
    ctx.fillStyle = 'rgba(255,255,255,' + (twinkle * 0.3) + ')';
    ctx.fill();
  }
}

function drawConnections() {
  var count = 0;
  for (var i = 0; i < particles.length && count < 400; i += 4) {
    for (var j = i + 4; j < particles.length && count < 400; j += 4) {
      var dx = particles[i].x - particles[j].x;
      var dy = particles[i].y - particles[j].y;
      var d = dx * dx + dy * dy;
      if (d < 2000) {
        count++;
        var alpha = (1 - d / 2000) * 0.12;
        var h = (particles[i].hue + globalTime * 10) % 360;
        ctx.beginPath();
        ctx.moveTo(particles[i].x, particles[i].y);
        ctx.lineTo(particles[j].x, particles[j].y);
        ctx.strokeStyle = 'hsla(' + h + ',70%,60%,' + alpha + ')';
        ctx.lineWidth = 0.5;
        ctx.stroke();
      }
    }
  }
}

function drawHandCursor() {
  var hx = handX * W, hy = handY * H;
  var gradient = ctx.createRadialGradient(hx, hy, 0, hx, hy, 100);
  gradient.addColorStop(0, 'hsla(' + (globalTime * 50 % 360) + ',80%,70%,0.25)');
  gradient.addColorStop(1, 'transparent');
  ctx.beginPath();
  ctx.arc(hx, hy, 100, 0, Math.PI * 2);
  ctx.fillStyle = gradient;
  ctx.fill();
  ctx.beginPath();
  ctx.arc(hx, hy, 20 + Math.sin(globalTime * 3) * 5, 0, Math.PI * 2);
  ctx.strokeStyle = 'hsla(' + (globalTime * 50 % 360) + ',80%,70%,0.4)';
  ctx.lineWidth = 2;
  ctx.stroke();
}

function animate() {
  globalTime += 0.016;
  drawBackground();
  drawConnections();
  for (var i = 0; i < particles.length; i++) {
    particles[i].update();
    particles[i].draw();
  }
  drawHandCursor();
  requestAnimationFrame(animate);
}

window.addEventListener('resize', function() {
  resize();
  initTextCanvas();
  setFormation(currentFormation);
});

setFormation(0);
animate();
</script>
</body>
</html>